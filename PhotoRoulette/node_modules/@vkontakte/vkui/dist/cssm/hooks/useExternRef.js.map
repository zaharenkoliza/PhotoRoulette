{"version":3,"sources":["../../../src/hooks/useExternRef.ts"],"sourcesContent":["import * as React from 'react';\nimport { setRef } from '../lib/utils';\n\nclass ExternalRef<T> implements React.MutableRefObject<T | null> {\n  #element: T | null = null;\n  readonly #externRefs = new Set<React.Ref<T>>();\n\n  constructor(externRefs: Array<React.Ref<T> | undefined | false> = []) {\n    externRefs.forEach((ref) => {\n      if (ref) {\n        this.#externRefs.add(ref);\n      }\n    });\n  }\n\n  updateExternRefs(refs: Array<React.Ref<T> | undefined | false>) {\n    refs.forEach((ref) => {\n      if (!ref || this.#externRefs.has(ref)) {\n        return;\n      }\n\n      setRef(this.#element, ref);\n      this.#externRefs.add(ref);\n    });\n  }\n\n  get current() {\n    return this.#element;\n  }\n\n  set current(el) {\n    this.#element = el;\n    this.#externRefs.forEach((ref) => setRef(el, ref));\n  }\n\n  /**\n   * React проверяет наличие свойства current у объектов через hasOwnProperty\n   *\n   * https://github.com/facebook/react/blob/c3cdbec0a78d39b5ff7329384cb41c4573a38212/packages/react-reconciler/src/ReactFiberCommitWork.js#L1612\n   */\n  hasOwnProperty(v: PropertyKey): v is keyof ExternalRef<T> {\n    return v === 'current';\n  }\n}\n\nexport function useExternRef<T>(\n  ...externRefs: Array<React.Ref<T> | undefined | false>\n): React.MutableRefObject<T | null> {\n  const ref = React.useRef<ExternalRef<T> | null>(null);\n  if (ref.current === null) {\n    ref.current = new ExternalRef(externRefs);\n  } else {\n    ref.current.updateExternRefs(externRefs);\n  }\n\n  return ref.current;\n}\n"],"names":["React","setRef","ExternalRef","Set","constructor","externRefs","forEach","ref","add","updateExternRefs","refs","has","current","el","hasOwnProperty","v","useExternRef","useRef"],"mappings":"AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,MAAM,QAAQ,eAAe;AAEtC,MAAMC;IACJ,CAAA,OAAQ,GAAa,KAAK;IACjB,CAAA,UAAW,GAAG,IAAIC,MAAoB;IAE/CC,YAAYC,aAAsD,EAAE,CAAE;QACpEA,WAAWC,OAAO,CAAC,CAACC;YAClB,IAAIA,KAAK;gBACP,IAAI,CAAC,CAAA,UAAW,CAACC,GAAG,CAACD;YACvB;QACF;IACF;IAEAE,iBAAiBC,IAA6C,EAAE;QAC9DA,KAAKJ,OAAO,CAAC,CAACC;YACZ,IAAI,CAACA,OAAO,IAAI,CAAC,CAAA,UAAW,CAACI,GAAG,CAACJ,MAAM;gBACrC;YACF;YAEAN,OAAO,IAAI,CAAC,CAAA,OAAQ,EAAEM;YACtB,IAAI,CAAC,CAAA,UAAW,CAACC,GAAG,CAACD;QACvB;IACF;IAEA,IAAIK,UAAU;QACZ,OAAO,IAAI,CAAC,CAAA,OAAQ;IACtB;IAEA,IAAIA,QAAQC,EAAE,EAAE;QACd,IAAI,CAAC,CAAA,OAAQ,GAAGA;QAChB,IAAI,CAAC,CAAA,UAAW,CAACP,OAAO,CAAC,CAACC,MAAQN,OAAOY,IAAIN;IAC/C;IAEA;;;;GAIC,GACDO,eAAeC,CAAc,EAA6B;QACxD,OAAOA,MAAM;IACf;AACF;AAEA,OAAO,SAASC,aACd,GAAGX,UAAmD;IAEtD,MAAME,MAAMP,MAAMiB,MAAM,CAAwB;IAChD,IAAIV,IAAIK,OAAO,KAAK,MAAM;QACxBL,IAAIK,OAAO,GAAG,IAAIV,YAAYG;IAChC,OAAO;QACLE,IAAIK,OAAO,CAACH,gBAAgB,CAACJ;IAC/B;IAEA,OAAOE,IAAIK,OAAO;AACpB"}