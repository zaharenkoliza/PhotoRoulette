{"version":3,"sources":["../../../../../src/components/ImageBase/ImageBaseOverlay/ImageBaseOverlay.tsx"],"sourcesContent":["import * as React from 'react';\nimport { classNames } from '@vkontakte/vkjs';\nimport { useAdaptivityHasPointer } from '../../../hooks/useAdaptivityHasPointer';\nimport { useAppearance } from '../../../hooks/useAppearance';\nimport { useExternRef } from '../../../hooks/useExternRef';\nimport { useFocusVisible } from '../../../hooks/useFocusVisible';\nimport { useFocusVisibleClassName } from '../../../hooks/useFocusVisibleClassName';\nimport { clickByKeyboardHandler } from '../../../lib/utils';\nimport { ImageBaseContext } from '../context';\nimport { validateOverlayIcon } from '../validators';\nimport { useNonInteractiveOverlayProps } from './hooks';\nimport type {\n  ImageBaseOverlayInteractiveProps,\n  ImageBaseOverlayNonInteractiveProps,\n} from './types';\nimport styles from './ImageBaseOverlay.module.css';\n\nfunction DevelopmentCheck({ children }: Pick<ImageBaseOverlayInteractiveProps, 'children'>) {\n  const { size } = React.useContext(ImageBaseContext);\n\n  if (process.env.NODE_ENV === 'development') {\n    if (children) {\n      validateOverlayIcon(size, { name: 'children', value: children });\n    }\n  }\n\n  return null;\n}\n\nexport type ImageBaseOverlayProps =\n  | ImageBaseOverlayInteractiveProps\n  | ImageBaseOverlayNonInteractiveProps;\n\nconst ImageBaseOverlayInteractive = ({\n  children,\n  className,\n  getRootRef,\n  disableInteractive,\n  overlayShown,\n  ...restProps\n}: ImageBaseOverlayInteractiveProps & { overlayShown?: boolean }) => {\n  const { focusVisible, ...focusEvents } = useFocusVisible();\n  const focusVisibleClassNames = useFocusVisibleClassName({ focusVisible, mode: 'inside' });\n\n  return (\n    <>\n      <div\n        {...restProps}\n        tabIndex={0}\n        role=\"button\"\n        className={classNames(\n          styles['ImageBaseOverlay--clickable'],\n          (focusVisible || overlayShown) && styles['ImageBaseOverlay--visible'],\n          focusVisibleClassNames,\n          className,\n        )}\n        ref={getRootRef}\n        onKeyDown={clickByKeyboardHandler}\n        {...focusEvents}\n      >\n        {children}\n      </div>\n      {process.env.NODE_ENV === 'development' && <DevelopmentCheck>{children}</DevelopmentCheck>}\n    </>\n  );\n};\n\nconst ImageBaseOverlayNonInteractive = ({\n  className,\n  getRootRef,\n  disableInteractive,\n  overlayShown: overlayShownProps,\n  ...restProps\n}: ImageBaseOverlayNonInteractiveProps & { overlayShown?: boolean }) => {\n  const rootRef = useExternRef(getRootRef);\n  const { shown: overlayShown, onClick: onOverlayClick } = useNonInteractiveOverlayProps(rootRef);\n\n  return (\n    <div\n      {...restProps}\n      ref={rootRef}\n      className={classNames(\n        (overlayShown || overlayShownProps) && styles['ImageBaseOverlay--visible'],\n        className,\n      )}\n      onClick={onOverlayClick}\n    />\n  );\n};\n\n/**\n * Оверлей над картинкой.\n */\nexport const ImageBaseOverlay: React.FC<ImageBaseOverlayProps> = ({\n  className,\n  theme: themeProp,\n  visibility: visibilityProp,\n  ...restProps\n}: ImageBaseOverlayProps) => {\n  const appearance = useAppearance();\n  const hasPointer = useAdaptivityHasPointer();\n  const theme = themeProp ?? appearance;\n  const visibility = visibilityProp ?? (hasPointer ? 'on-hover' : 'always');\n\n  const commonClassNames = classNames(\n    styles['ImageBaseOverlay'],\n    theme === 'light' && styles['ImageBaseOverlay--theme-light'],\n    theme === 'dark' && styles['ImageBaseOverlay--theme-dark'],\n    className,\n  );\n\n  const commonProps = {\n    className: commonClassNames,\n    overlayShown: visibility === 'always',\n  };\n\n  // Не делаем деструктуризацию пропа, потому что Typescript не вывозит\n  if (restProps.disableInteractive) {\n    return <ImageBaseOverlayNonInteractive {...restProps} {...commonProps} />;\n  }\n\n  return <ImageBaseOverlayInteractive {...restProps} {...commonProps} />;\n};\n\nImageBaseOverlay.displayName = 'ImageBaseOverlay';\n"],"names":["ImageBaseOverlay","DevelopmentCheck","children","size","React","useContext","ImageBaseContext","process","env","NODE_ENV","validateOverlayIcon","name","value","ImageBaseOverlayInteractive","className","getRootRef","disableInteractive","overlayShown","restProps","useFocusVisible","focusVisible","focusEvents","focusVisibleClassNames","useFocusVisibleClassName","mode","div","tabIndex","role","classNames","ref","onKeyDown","clickByKeyboardHandler","ImageBaseOverlayNonInteractive","overlayShownProps","rootRef","useExternRef","shown","onClick","onOverlayClick","useNonInteractiveOverlayProps","theme","themeProp","visibility","visibilityProp","appearance","useAppearance","hasPointer","useAdaptivityHasPointer","commonClassNames","commonProps","displayName"],"mappings":";;;;+BA6FaA;;;eAAAA;;;;;;;;iEA7FU;sBACI;yCACa;+BACV;8BACD;iCACG;0CACS;uBACF;yBACN;4BACG;uBACU;AAO9C,SAASC,iBAAiB,EAAEC,QAAQ,EAAsD;IACxF,MAAM,EAAEC,IAAI,EAAE,GAAGC,OAAMC,UAAU,CAACC,yBAAgB;IAElD,IAAIC,QAAQC,GAAG,CAACC,QAAQ,KAAK,eAAe;QAC1C,IAAIP,UAAU;YACZQ,IAAAA,+BAAmB,EAACP,MAAM;gBAAEQ,MAAM;gBAAYC,OAAOV;YAAS;QAChE;IACF;IAEA,OAAO;AACT;AAMA,MAAMW,8BAA8B;QAAC,EACnCX,QAAQ,EACRY,SAAS,EACTC,UAAU,EACVC,kBAAkB,EAClBC,YAAY,EAEkD,WAD3DC;QALHhB;QACAY;QACAC;QACAC;QACAC;;IAGA,MAAyCE,oBAAAA,IAAAA,gCAAe,KAAlD,EAAEC,YAAY,EAAkB,GAAGD,mBAAhBE,2CAAgBF;QAAjCC;;IACR,MAAME,yBAAyBC,IAAAA,kDAAwB,EAAC;QAAEH;QAAcI,MAAM;IAAS;IAEvF,qBACE;;0BACE,qBAACC,2FACKP;gBACJQ,UAAU;gBACVC,MAAK;gBACLb,WAAWc,IAAAA,gBAAU,qCAEnB,AAACR,CAAAA,gBAAgBH,YAAW,sCAC5BK,wBACAR;gBAEFe,KAAKd;gBACLe,WAAWC,6BAAsB;gBAC7BV;0BAEHnB;;YAEFK,QAAQC,GAAG,CAACC,QAAQ,KAAK,+BAAiB,qBAACR;0BAAkBC;;;;AAGpE;AAEA,MAAM8B,iCAAiC;QAAC,EACtClB,SAAS,EACTC,UAAU,EACVC,kBAAkB,EAClBC,cAAcgB,iBAAiB,EAEkC,WAD9Df;QAJHJ;QACAC;QACAC;QACAC;;IAGA,MAAMiB,UAAUC,IAAAA,0BAAY,EAACpB;IAC7B,MAAM,EAAEqB,OAAOnB,YAAY,EAAEoB,SAASC,cAAc,EAAE,GAAGC,IAAAA,oCAA6B,EAACL;IAEvF,qBACE,qBAACT,mDACKP;QACJW,KAAKK;QACLpB,WAAWc,IAAAA,gBAAU,EACnB,AAACX,CAAAA,gBAAgBgB,iBAAgB,sCACjCnB;QAEFuB,SAASC;;AAGf;AAKO,MAAMtC,mBAAoD;QAAC,EAChEc,SAAS,EACT0B,OAAOC,SAAS,EAChBC,YAAYC,cAAc,EAEJ,WADnBzB;QAHHJ;QACA0B;QACAE;;IAGA,MAAME,aAAaC,IAAAA,4BAAa;IAChC,MAAMC,aAAaC,IAAAA,gDAAuB;IAC1C,MAAMP,QAAQC,sBAAAA,uBAAAA,YAAaG;IAC3B,MAAMF,aAAaC,2BAAAA,4BAAAA,iBAAmBG,aAAa,aAAa;IAEhE,MAAME,mBAAmBpB,IAAAA,gBAAU,0BAEjCY,UAAU,gDACVA,UAAU,8CACV1B;IAGF,MAAMmC,cAAc;QAClBnC,WAAWkC;QACX/B,cAAcyB,eAAe;IAC/B;IAEA,qEAAqE;IACrE,IAAIxB,UAAUF,kBAAkB,EAAE;QAChC,qBAAO,qBAACgB,qDAAmCd,WAAe+B;IAC5D;IAEA,qBAAO,qBAACpC,kDAAgCK,WAAe+B;AACzD;AAEAjD,iBAAiBkD,WAAW,GAAG"}