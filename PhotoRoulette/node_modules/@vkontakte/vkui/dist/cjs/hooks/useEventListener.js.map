{"version":3,"sources":["../../../src/hooks/useEventListener.ts"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { canUseDOM } from '../lib/dom';\n\ninterface EventListenerHandle {\n  add: (el: HTMLElement | Document | Window) => void;\n  remove: () => void;\n}\n\nclass EventListener implements EventListenerHandle {\n  callback: (ev: any) => void = noop;\n  options: AddEventListenerOptions | boolean | undefined = undefined;\n  eventType: string;\n  #target: HTMLElement | Document | Window | null = null;\n\n  constructor(\n    type: string,\n    callback: false | null | undefined | ((ev: any) => void),\n    options?: AddEventListenerOptions | boolean,\n  ) {\n    this.options = options;\n    this.eventType = type;\n\n    if (callback) {\n      this.callback = callback;\n    }\n  }\n\n  readonly #listener = (ev: any) => {\n    this.callback(ev);\n  };\n\n  add = (el: HTMLElement | Document | Window) => {\n    if (!canUseDOM) {\n      return;\n    }\n    this.remove();\n    if (!el) {\n      return;\n    }\n\n    el.addEventListener(this.eventType, this.#listener, this.options);\n    this.#target = el;\n  };\n\n  remove = () => {\n    if (!canUseDOM || !this.#target) {\n      return;\n    }\n\n    this.#target.removeEventListener(this.eventType, this.#listener, this.options);\n    this.#target = null;\n  };\n}\n\nexport function useEventListener<K extends keyof GlobalEventHandlersEventMap>(\n  event: K,\n  _cb: false | null | undefined | ((ev: GlobalEventHandlersEventMap[K]) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle;\nexport function useEventListener<E extends Event>(\n  event: string,\n  _cb: false | null | undefined | ((ev: E) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle;\nexport function useEventListener<E extends Event, K extends keyof GlobalEventHandlersEventMap>(\n  event: string | K,\n  _cb: false | null | undefined | ((ev: E) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle {\n  const ref = React.useRef<EventListener | null>(null);\n  if (ref.current === null) {\n    ref.current = new EventListener(event, _cb, _options);\n  } else {\n    ref.current.eventType = event;\n    ref.current.options = _options;\n\n    if (_cb) {\n      ref.current.callback = _cb;\n    }\n  }\n\n  React.useEffect(() => {\n    const detach = ref.current?.remove.bind(ref.current);\n    return detach;\n  }, []);\n\n  return ref.current;\n}\n"],"names":["useEventListener","EventListener","constructor","type","callback","options","noop","undefined","eventType","ev","add","el","canUseDOM","remove","addEventListener","removeEventListener","event","_cb","_options","ref","React","useRef","current","useEffect","detach","bind"],"mappings":";;;;+BAiEgBA;;;eAAAA;;;;;;;;iEAjEO;sBACF;qBACK;IAWxB,uCAeS;AAnBX,MAAMC;IAMJC,YACEC,IAAY,EACZC,QAAwD,EACxDC,OAA2C,CAC3C;QATFD,yBAAAA,YAA8BE,UAAI;QAClCD,yBAAAA,WAAyDE;QACzDC,yBAAAA,aAAAA,KAAAA;QACA,kCAAA;;mBAAkD;;QAelD,kCAAS;;mBAAY,CAACC;gBACpB,IAAI,CAACL,QAAQ,CAACK;YAChB;;QAEAC,yBAAAA,OAAM,CAACC;YACL,IAAI,CAACC,cAAS,EAAE;gBACd;YACF;YACA,IAAI,CAACC,MAAM;YACX,IAAI,CAACF,IAAI;gBACP;YACF;YAEAA,GAAGG,gBAAgB,CAAC,IAAI,CAACN,SAAS,6BAAE,IAAI,EAAC,YAAW,IAAI,CAACH,OAAO;6CAC3D,SAAUM;QACjB;QAEAE,yBAAAA,UAAS;YACP,IAAI,CAACD,cAAS,IAAI,4BAAC,IAAI,EAAC,UAAS;gBAC/B;YACF;YAEA,2BAAA,IAAI,EAAC,SAAQG,mBAAmB,CAAC,IAAI,CAACP,SAAS,6BAAE,IAAI,EAAC,YAAW,IAAI,CAACH,OAAO;6CACxE,SAAU;QACjB;QAhCE,IAAI,CAACA,OAAO,GAAGA;QACf,IAAI,CAACG,SAAS,GAAGL;QAEjB,IAAIC,UAAU;YACZ,IAAI,CAACA,QAAQ,GAAGA;QAClB;IACF;AA2BF;AAYO,SAASJ,iBACdgB,KAAiB,EACjBC,GAAiD,EACjDC,QAAkC;IAElC,MAAMC,MAAMC,OAAMC,MAAM,CAAuB;IAC/C,IAAIF,IAAIG,OAAO,KAAK,MAAM;QACxBH,IAAIG,OAAO,GAAG,IAAIrB,cAAce,OAAOC,KAAKC;IAC9C,OAAO;QACLC,IAAIG,OAAO,CAACd,SAAS,GAAGQ;QACxBG,IAAIG,OAAO,CAACjB,OAAO,GAAGa;QAEtB,IAAID,KAAK;YACPE,IAAIG,OAAO,CAAClB,QAAQ,GAAGa;QACzB;IACF;IAEAG,OAAMG,SAAS,CAAC;YACCJ;QAAf,MAAMK,UAASL,eAAAA,IAAIG,OAAO,cAAXH,mCAAAA,aAAaN,MAAM,CAACY,IAAI,CAACN,IAAIG,OAAO;QACnD,OAAOE;IACT,GAAG,EAAE;IAEL,OAAOL,IAAIG,OAAO;AACpB"}