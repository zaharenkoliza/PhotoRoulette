{"version":3,"sources":["../../../src/hooks/useExternRef.ts"],"sourcesContent":["import * as React from 'react';\nimport { setRef } from '../lib/utils';\n\nclass ExternalRef<T> implements React.MutableRefObject<T | null> {\n  #element: T | null = null;\n  readonly #externRefs = new Set<React.Ref<T>>();\n\n  constructor(externRefs: Array<React.Ref<T> | undefined | false> = []) {\n    externRefs.forEach((ref) => {\n      if (ref) {\n        this.#externRefs.add(ref);\n      }\n    });\n  }\n\n  updateExternRefs(refs: Array<React.Ref<T> | undefined | false>) {\n    refs.forEach((ref) => {\n      if (!ref || this.#externRefs.has(ref)) {\n        return;\n      }\n\n      setRef(this.#element, ref);\n      this.#externRefs.add(ref);\n    });\n  }\n\n  get current() {\n    return this.#element;\n  }\n\n  set current(el) {\n    this.#element = el;\n    this.#externRefs.forEach((ref) => setRef(el, ref));\n  }\n\n  /**\n   * React проверяет наличие свойства current у объектов через hasOwnProperty\n   *\n   * https://github.com/facebook/react/blob/c3cdbec0a78d39b5ff7329384cb41c4573a38212/packages/react-reconciler/src/ReactFiberCommitWork.js#L1612\n   */\n  hasOwnProperty(v: PropertyKey): v is keyof ExternalRef<T> {\n    return v === 'current';\n  }\n}\n\nexport function useExternRef<T>(\n  ...externRefs: Array<React.Ref<T> | undefined | false>\n): React.MutableRefObject<T | null> {\n  const ref = React.useRef<ExternalRef<T> | null>(null);\n  if (ref.current === null) {\n    ref.current = new ExternalRef(externRefs);\n  } else {\n    ref.current.updateExternRefs(externRefs);\n  }\n\n  return ref.current;\n}\n"],"names":["useExternRef","ExternalRef","updateExternRefs","refs","forEach","ref","has","setRef","add","current","el","hasOwnProperty","v","constructor","externRefs","Set","React","useRef"],"mappings":";;;;+BA6CgBA;;;eAAAA;;;;;;;iEA7CO;uBACA;IAGrB,wCACS;AAFX,MAAMC;IAYJC,iBAAiBC,IAA6C,EAAE;QAC9DA,KAAKC,OAAO,CAAC,CAACC;YACZ,IAAI,CAACA,OAAO,2BAAA,IAAI,EAAC,aAAYC,GAAG,CAACD,MAAM;gBACrC;YACF;YAEAE,IAAAA,aAAM,6BAAC,IAAI,EAAC,WAAUF;YACtB,2BAAA,IAAI,EAAC,aAAYG,GAAG,CAACH;QACvB;IACF;IAEA,IAAII,UAAU;QACZ,kCAAO,IAAI,EAAC;IACd;IAEA,IAAIA,QAAQC,EAAE,EAAE;yCACT,UAAWA;QAChB,2BAAA,IAAI,EAAC,aAAYN,OAAO,CAAC,CAACC,MAAQE,IAAAA,aAAM,EAACG,IAAIL;IAC/C;IAEA;;;;GAIC,GACDM,eAAeC,CAAc,EAA6B;QACxD,OAAOA,MAAM;IACf;IAnCAC,YAAYC,aAAsD,EAAE,CAAE;QAHtE,kCAAA;;mBAAqB;;QACrB,kCAAS;;mBAAc,IAAIC;;QAGzBD,WAAWV,OAAO,CAAC,CAACC;YAClB,IAAIA,KAAK;gBACP,2BAAA,IAAI,EAAC,aAAYG,GAAG,CAACH;YACvB;QACF;IACF;AA8BF;AAEO,SAASL,aACd,GAAGc,UAAmD;IAEtD,MAAMT,MAAMW,OAAMC,MAAM,CAAwB;IAChD,IAAIZ,IAAII,OAAO,KAAK,MAAM;QACxBJ,IAAII,OAAO,GAAG,IAAIR,YAAYa;IAChC,OAAO;QACLT,IAAII,OAAO,CAACP,gBAAgB,CAACY;IAC/B;IAEA,OAAOT,IAAII,OAAO;AACpB"}