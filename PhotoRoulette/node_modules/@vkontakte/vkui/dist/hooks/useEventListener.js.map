{"version":3,"sources":["../../src/hooks/useEventListener.ts"],"sourcesContent":["import * as React from 'react';\nimport { noop } from '@vkontakte/vkjs';\nimport { canUseDOM } from '../lib/dom';\n\ninterface EventListenerHandle {\n  add: (el: HTMLElement | Document | Window) => void;\n  remove: () => void;\n}\n\nclass EventListener implements EventListenerHandle {\n  callback: (ev: any) => void = noop;\n  options: AddEventListenerOptions | boolean | undefined = undefined;\n  eventType: string;\n  #target: HTMLElement | Document | Window | null = null;\n\n  constructor(\n    type: string,\n    callback: false | null | undefined | ((ev: any) => void),\n    options?: AddEventListenerOptions | boolean,\n  ) {\n    this.options = options;\n    this.eventType = type;\n\n    if (callback) {\n      this.callback = callback;\n    }\n  }\n\n  readonly #listener = (ev: any) => {\n    this.callback(ev);\n  };\n\n  add = (el: HTMLElement | Document | Window) => {\n    if (!canUseDOM) {\n      return;\n    }\n    this.remove();\n    if (!el) {\n      return;\n    }\n\n    el.addEventListener(this.eventType, this.#listener, this.options);\n    this.#target = el;\n  };\n\n  remove = () => {\n    if (!canUseDOM || !this.#target) {\n      return;\n    }\n\n    this.#target.removeEventListener(this.eventType, this.#listener, this.options);\n    this.#target = null;\n  };\n}\n\nexport function useEventListener<K extends keyof GlobalEventHandlersEventMap>(\n  event: K,\n  _cb: false | null | undefined | ((ev: GlobalEventHandlersEventMap[K]) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle;\nexport function useEventListener<E extends Event>(\n  event: string,\n  _cb: false | null | undefined | ((ev: E) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle;\nexport function useEventListener<E extends Event, K extends keyof GlobalEventHandlersEventMap>(\n  event: string | K,\n  _cb: false | null | undefined | ((ev: E) => void),\n  _options?: AddEventListenerOptions,\n): EventListenerHandle {\n  const ref = React.useRef<EventListener | null>(null);\n  if (ref.current === null) {\n    ref.current = new EventListener(event, _cb, _options);\n  } else {\n    ref.current.eventType = event;\n    ref.current.options = _options;\n\n    if (_cb) {\n      ref.current.callback = _cb;\n    }\n  }\n\n  React.useEffect(() => {\n    const detach = ref.current?.remove.bind(ref.current);\n    return detach;\n  }, []);\n\n  return ref.current;\n}\n"],"names":["React","noop","canUseDOM","EventListener","constructor","type","callback","options","undefined","eventType","ev","add","el","remove","addEventListener","removeEventListener","useEventListener","event","_cb","_options","ref","useRef","current","useEffect","detach","bind"],"mappings":";;;;AAAA,YAAYA,WAAW,QAAQ;AAC/B,SAASC,IAAI,QAAQ,kBAAkB;AACvC,SAASC,SAAS,QAAQ,aAAa;IAWrC,uCAeS;AAnBX,MAAMC;IAMJC,YACEC,IAAY,EACZC,QAAwD,EACxDC,OAA2C,CAC3C;QATFD,uBAAAA,YAA8BL;QAC9BM,uBAAAA,WAAyDC;QACzDC,uBAAAA,aAAAA,KAAAA;QACA,gCAAA;;mBAAkD;;QAelD,gCAAS;;mBAAY,CAACC;gBACpB,IAAI,CAACJ,QAAQ,CAACI;YAChB;;QAEAC,uBAAAA,OAAM,CAACC;YACL,IAAI,CAACV,WAAW;gBACd;YACF;YACA,IAAI,CAACW,MAAM;YACX,IAAI,CAACD,IAAI;gBACP;YACF;YAEAA,GAAGE,gBAAgB,CAAC,IAAI,CAACL,SAAS,2BAAE,IAAI,EAAC,YAAW,IAAI,CAACF,OAAO;2CAC3D,SAAUK;QACjB;QAEAC,uBAAAA,UAAS;YACP,IAAI,CAACX,aAAa,0BAAC,IAAI,EAAC,UAAS;gBAC/B;YACF;YAEA,yBAAA,IAAI,EAAC,SAAQa,mBAAmB,CAAC,IAAI,CAACN,SAAS,2BAAE,IAAI,EAAC,YAAW,IAAI,CAACF,OAAO;2CACxE,SAAU;QACjB;QAhCE,IAAI,CAACA,OAAO,GAAGA;QACf,IAAI,CAACE,SAAS,GAAGJ;QAEjB,IAAIC,UAAU;YACZ,IAAI,CAACA,QAAQ,GAAGA;QAClB;IACF;AA2BF;AAYA,OAAO,SAASU,iBACdC,KAAiB,EACjBC,GAAiD,EACjDC,QAAkC;IAElC,MAAMC,MAAMpB,MAAMqB,MAAM,CAAuB;IAC/C,IAAID,IAAIE,OAAO,KAAK,MAAM;QACxBF,IAAIE,OAAO,GAAG,IAAInB,cAAcc,OAAOC,KAAKC;IAC9C,OAAO;QACLC,IAAIE,OAAO,CAACb,SAAS,GAAGQ;QACxBG,IAAIE,OAAO,CAACf,OAAO,GAAGY;QAEtB,IAAID,KAAK;YACPE,IAAIE,OAAO,CAAChB,QAAQ,GAAGY;QACzB;IACF;IAEAlB,MAAMuB,SAAS,CAAC;YACCH;QAAf,MAAMI,UAASJ,eAAAA,IAAIE,OAAO,cAAXF,mCAAAA,aAAaP,MAAM,CAACY,IAAI,CAACL,IAAIE,OAAO;QACnD,OAAOE;IACT,GAAG,EAAE;IAEL,OAAOJ,IAAIE,OAAO;AACpB"}